const {
  bash
} = require('./helper')

const argv = require('minimist')(process.argv.slice(2))

if (!argv.e || !argv.b || !argv.p) {
  // eslint-disable-next-line
  console.log('deploy.js requires: -e (eTag), -b (bucket) and, -p (profile)')
} else {

  let id = argv.e
  let bucket = argv.b
  let profile = argv.p

  let createInvalidation = (id) => {
    return bash('aws', ['cloudfront', 'create-invalidation', '--distribution-id', id, '--paths', '/*', '--profile', profile])
  }

  let s3Copy = new Promise(function (resolve, reject) {
    resolve(bash('aws', ['s3', 'sync', 'dist/', `s3://${bucket}/`, '--profile', profile]))
  })

  s3Copy
    .then(() => {
      createInvalidation(id)
    })
}
